import requests
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import ApplicationBuilder, CommandHandler, ContextTypes
from datetime import datetime

# Giá»¯ nguyÃªn Token bot
BOT_TOKEN = 'Your Token Bot'

# Lá»‡nh /start
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user = update.effective_user
    user_id = user.id
    user_name = user.first_name
    current_time = datetime.now().strftime("%I:%M:%S %p")
    current_date = datetime.now().strftime("%Y-%m-%d")

    welcome_message = f"""
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ¨ Welcome, {user_name}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ‘¤ User Details:
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”œ ğŸ†” User ID: {user_id}
â”œ â° Time: {current_time}
â”œ ğŸ“… Date: {current_date}
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

ğŸ“– Commands:
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”œ ğŸ“œ /help: View all available commands
â”œ ğŸ”„ /start: Restart the bot
â”œ ğŸš™ /info <vehicle number>: Get Vehicle Info
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

ğŸ‡¬ğŸ‡§ English: First, you have to join our support group. Then you can use the bot.

ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤‚à¤¦à¥€: à¤¸à¤¬à¤¸à¥‡ à¤ªà¤¹à¤²à¥‡ à¤†à¤ªà¤•à¥‹ à¤¹à¤®à¤¾à¤°à¥‡ à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾ à¤¸à¤®à¥‚à¤¹ à¤¸à¥‡ à¤œà¥à¤¡à¤¼à¤¨à¤¾ à¤¹à¥‹à¤—à¤¾à¥¤ à¤‰à¤¸à¤•à¥‡ à¤¬à¤¾à¤¦ à¤†à¤ª à¤‡à¤¸ à¤¬à¥‰à¤Ÿ à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤° à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚.

ğŸ”— Join Us: 
Click here to join our channel/group!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ˜Š Enjoy your experience with the bot!
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
"""

    # ThÃªm 2 button URL
    keyboard = [
      [InlineKeyboardButton("ğŸ”— YouTube", url="buttonurl:https://www.youtube.com/@Nishant_sarkar")],
      [InlineKeyboardButton("ğŸ”¥ Free Fire Likes", url="https://t.me/NSfreefirelikesvip")]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)

    await update.message.reply_text(welcome_message, reply_markup=reply_markup)

# Lá»‡nh /vh Ä‘á»ƒ láº¥y thÃ´ng tin xe
async def vehicle_info(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if len(context.args) == 0:
        await update.message.reply_text("ğŸ’¡ Enter your vehicle number to fetch its details.", parse_mode="Markdown")
        return

    vehicle_number = context.args[0].upper()
    api_url = f"https://vehicleinfo.taitanapi.workers.dev/?number={vehicle_number}"

    # Hiá»ƒn thá»‹ tráº¡ng thÃ¡i "Äang soáº¡n tin nháº¯n..."
    await context.bot.send_chat_action(chat_id=update.effective_chat.id, action="typing")

    try:
        response = requests.get(api_url, timeout=5)  # TÄƒng tá»‘c báº±ng timeout
        data = response.json()

        if "data" not in data:
            await update.message.reply_text("ğŸ’¡ Enter your vehicle number to fetch its details.")
            return

        vehicle = data["data"]

        # Hiá»ƒn thá»‹ Ä‘áº§y Ä‘á»§ thÃ´ng tin
        vehicle_message = f"""
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€(ğŸš— *Vehicle Details* ğŸš—)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â¦¿
â”‚â–¸ ğŸ”¢ *Vehicle Number:* `{vehicle.get('VEHICLE_NUM', 'N/A')}`
â”‚â–¸ ğŸ¢ *Brand:* `{vehicle.get('BRAND', 'N/A')}`
â”‚â–¸ ğŸš™ *Model:* `{vehicle.get('VEHICLE_MODEL', 'N/A')}`
â”‚â–¸ ğŸ‘¤ *Owner:* `{vehicle.get('NAME', 'N/A')}`
â”‚â–¸ ğŸ›¡ï¸ *Role:* `{vehicle.get('ROLE', 'N/A')}`
â”‚â–¸ ğŸ¦ *Insurance By:* `{vehicle.get('INSURANCE_BY', 'N/A')}`
â”‚â–¸ ğŸ“… *Insurance Expiry:* `{vehicle.get('date_of_insurance_expiry', 'N/A')}`
â”‚â–¸ â³ *Days Left:* `{vehicle.get('DAYS_LEFT', 'N/A')}`
â”‚â–¸ ğŸ‘¥ *Owner Number:* `{vehicle.get('OWNER_NUM', 'N/A')}`
â”‚â–¸ ğŸ—ï¸ *Commercial:* `{vehicle.get('isCommercial', 'N/A')}`
â”‚â–¸ ğŸ—“ï¸ *Registration Date:* `{vehicle.get('REG_DATE', 'N/A')}`
â”‚â–¸ ğŸ¤‘ *Eligible for Sell:* `{vehicle.get('SELL_ELIGIBLE', 'N/A')}`
â”‚â–¸ ğŸ›ï¸ *Eligible for Buy:* `{vehicle.get('OWNER', 'N/A')}`
â”‚â–¸ ğŸ” *Probable Vehicle Number:* `{vehicle.get('VEHICLE_NUM', 'N/A')}`
â”‚â–¸ ğŸ‚ *Vehicle Age:* `{vehicle.get('AGE', 'N/A')}`
â”‚â–¸ ğŸ›¡ï¸ *Insurance Eligible:* `{vehicle.get('INSURANCE_ELIGIBLE', 'N/A')}`
â”‚â–¸ âŒ *Is Expired:* `{vehicle.get('IS_EXPIRED', 'N/A')}`
â”‚â–¸ âŒ *Insurance Expired:* `{vehicle.get('INSURANCE_EXPIRED', 'N/A')}`
â”‚â–¸ ğŸ“ *Pincode:* `{vehicle.get('PINCODE', 'N/A')}`
â”‚â–¸ ğŸš˜ *Probable Vehicle Type:* `{vehicle.get('VEHICLE_TYPE', 'N/A')}`
â”‚â–¸ ğŸ“² *Source App:* `{vehicle.get('SRC_APP', 'N/A')}`
â”‚â–¸ ğŸ›‘ *Interstitial:* `{vehicle.get('INTERSTITIAL', 'N/A')}`
â”‚â–¸ ğŸ‘¤ *User ID:* `{vehicle.get('USERID', 'N/A')}`
â”‚â–¸ ğŸ“… *Created At:* `{vehicle.get('CREATED_AT', 'N/A')}`
â”‚â–¸ ğŸ“† *Expiring Today:* `{vehicle.get('expiringtoday', 'N/A')}`
â”‚â–¸ ğŸ“† *Expiring in One Day:* `{vehicle.get('expiringinoneday', 'N/A')}`
â”‚â–¸ ğŸš— *Vehicle Type:* `{vehicle.get('VEHICLE_TYPE', 'N/A')}`
â”‚â–¸ ğŸ”’ *Is Logged:* `{vehicle.get('IS_LOGGED', 'N/A')}`
â”‚â–¸ ğŸ“± *App Open Count:* `{vehicle.get('APP_OPEN', 'N/A')}`
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€({vehicle.get('NAME', 'N/A')})â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â¦¿
"""

        # ThÃªm 2 button URL dÆ°á»›i káº¿t quáº£
        keyboard = [
          [InlineKeyboardButton("ğŸ”— YouTube", url="https://www.youtube.com/@Nishant_sarkar")],
          [InlineKeyboardButton("ğŸ”¥ Free Fire Likes", url="https://t.me/NSfreefirelikesvip")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)

        await update.message.reply_text(vehicle_message, parse_mode="Markdown", reply_markup=reply_markup)

    except Exception:
        await update.message.reply_text("âš ï¸ ÄÃ£ xáº£y ra lá»—i khi láº¥y thÃ´ng tin. Vui lÃ²ng thá»­ láº¡i sau.")

# Khá»Ÿi Ä‘á»™ng bot
if __name__ == '__main__':
    app = ApplicationBuilder().token(BOT_TOKEN).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(CommandHandler("info", vehicle_info))

  print("ğŸ¤– Bot is running...")
    app.run_polling()
